pipeline {

  agent any

  environment {
    CI = 'true'
    NEXUS_USERNAME = credentials('exosdata')
    NEXUS_PASSWORD = credentials('stage')
  }

  stages {

    stage('Install Dependencies') {
      steps {
        sh 'npm install'
      }
    }

    stage('Build') {
      steps {
        sh 'npm run build'
      }
    }

    stage('Test') {
      steps {
        sh 'npm test'
      }
    }

    stage('Package') {
      steps {
        sh 'tar -zcvf build.tar.gz build/'
      }
    }

    stage('Deploy to Nexus') {
      steps {
        script {
        
          def nexusUrl = 'http://192.99.35.61:8081'
          def nexusRepo = 'simple'
          def fileName = 'build.tar.gz'
          
          nexusArtifactUploader(
            nexusVersion: 'nexus3',
            protocol: 'http',
            nexusUrl: nexusUrl,
            nexusRepository: nexusRepo,
            groupId: 'com.mycompany',
            repository: nexusRepo,
            credentialsId: 'nexus-credentials',
            username: env.NEXUS_USERNAME,
            artifacts: [
              [artifactId: 'simple',
               file: "${env.WORKSPACE}/${fileName}",
               type: 'tar.gz']
            ]
          )
              
        }
      }
    }

  }

}
