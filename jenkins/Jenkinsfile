pipeline {
  agent any
  

  environment {
    REACT_APP_VERSION = "1.0.0"
  }
  
  stages {
    stage('Build') {
      steps {
        sh 'npm install'
        sh 'npm run build' 
      }
    }
    
    stage('Deploy') {
      steps {
        script {
          zip archive: 'build.zip', dir: 'build'
        }
          
        withCredentials([usernamePassword(credentialsId: 'exosdata', passwordVariable: 'NEXUS_PASSWORD', usernameVariable: 'NEXUS_USERNAME')]) {
          sh """
            cd build
            curl -v -u "\$NEXUS_USERNAME:\$NEXUS_PASSWORD" \\
            --upload-file build.zip \\
            'http://192.99.35.61:8081/repository/simple/\$REACT_APP_VERSION/build.zip'
          """    
        }  
      }    
    }
  }
}
